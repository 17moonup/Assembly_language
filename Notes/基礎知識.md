# 匯編語言

#### :question:爲什麽要學習匯編

匯編語言是一門最貼近硬件實體的計算機語言,學習它能讓你理解或者説可以幫助你理解許多高級語言和操作系統課程以及數據結構中你可能感到困惑或者你忽略掉的重要問題,是學習計算機重要的基石。

不論你想要獲得充分的底層編程（編程的平臺是硬件而不是操作系統，後面會體驗一個裸機的環境下，也就是沒有操作系統的硬件上直接進行編程）體驗還是深刻理解機器運行程序的原理，學習匯編在我看來都是必要的。

“完全抛棄BIOS和DOS中斷，直接訪問硬件，發揮匯編語言的長處才是我們的目的”——《x86匯編語言從實模式到保護模式》

"利用硬件系統的編程結構和指令集有效靈活的控制系統進行工作"——《匯編語言》

### Hardware-based

在討論進入正題之前，先討論一下匯編語言的產生。

在討論匯編語言的產生之前，先看一下[機器語言:smiling_imp:](https://zh.wikipedia.org/zh-hant/%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80#:~:text=%E6%A9%9F%E5%99%A8%E8%AA%9E%E8%A8%80%20%EF%BC%88%20machine%20language%20%EF%BC%89%E6%98%AF%E4%B8%80%E7%A8%AE%20%E6%8C%87%E4%BB%A4%E9%9B%86%20%E7%9A%84%E9%AB%94%E7%B3%BB%E3%80%82%20%E9%80%99%E7%A8%AE%E6%8C%87%E4%BB%A4%E9%9B%86%E7%A8%B1%E7%82%BA,%EF%BC%88%20Native%20Code%20%EF%BC%89%EF%BC%8C%E9%80%99%E5%80%8B%E5%90%8D%E8%A9%9E%E6%AF%94%E8%BC%83%E5%BC%B7%E8%AA%BF%E6%9F%90%E7%A8%AE%20%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80%20%E6%88%96%20%E5%87%BD%E5%BC%8F%E5%BA%AB%20%E8%88%87%E5%9F%B7%E8%A1%8C%E5%B9%B3%E5%8F%B0%E7%9B%B8%E9%97%9C%E7%9A%84%E9%83%A8%E4%BB%BD%E3%80%82)

機器語言是比匯編語言還更Hardware的語言，如果沒有學習過計算機組成原理這門課建議先去看看[crash course computer science](https://www.bilibili.com/video/BV1EW411u7th?spm_id_from=333.337.search-card.all.click)這門課，涉及了數據是如何存儲在内存中的，内存又是如何保存數據的，以及一些加法器，還講解了計算機的歷史。

——————————————————————————————————————————————————

匯編語言和機器語言的差別在於指令的表示方法上，匯編指令是機器指令的便於人記憶的書寫形式。

#### 匯編語言的組成(這裏首先討論的是基於16位的INTEL8086處理器的匯編)

![](https://tse2-mm.cn.bing.net/th/id/OIP-C.qNrKEibuyMWcKYHPoo6uXAHaE8?pid=ImgDet&rs=1)

有20根地址綫，可以尋址2^20 = 1Mb 内存。32位的x86處理器擁有32條地址綫，可以尋址4GB，但32bit和16bit的差距絕不是增加了地址綫和數據綫這麽簡單，還包括了高速緩存、多處理器管理、分支預測、虛擬化、溫度以及電源管理等。

#### 匯編語言的組成

Need a Picture

- 匯編指令：機器碼的助記符，有對應的機器碼，最終會由CPU執行
- 僞指令：沒有對應的機器碼，最終由編譯器執行
- 其他符號：如“+，-,*,/"等，也由編譯器執行

指令（1~15 byte）和指令集：用某些數來指示處理器所進行的操作；一個處理器能識別的指令的集合叫做指令集。

- 操作碼隱含了如何執行該指令的信息（如mov，add，dec等是做什麽的以及如何去做的信息）
  - 操作數指出指令執行的操作所需要數據的來源。
    - 立即操作數：指令要操作的數據以常量的形式出現在指令中，也成爲立即數。
    - 寄存器操作數：指令要操作的數據存放在CPU的寄存器裏
    - 記憶體操作數：指令要操作的數據存放在内存的某些單元内，指令中給出内存單元的物理地址（以段地址+偏移地址的形式）

#### 指令和數據

指令和數據都在存儲器中存放，那既然指令和數據都是01組成的機器碼，**計算機又是如何區分二者**，**以及如何讀取指令和寫入指令的呢**？

這裏需要辯證的看待二者的關係，但從存儲形式上來看，它們都是一些高低電平組合，沒有區別，可以是數據也可以是程序：

​					如：1000100111011000   :arrow_right: 89D8H （數據）

​							1000100111011000   :arrow_right: mov  ax,bx （指令）

就像在棋盤上的圍棋，在沒下之前都一樣，對弈時產生了不同的意義。

但是，你無法保證所有的數據都有對應的程序形式，每種處理器在設計的時候都有幾十到幾百條程序指令，

而處理器是自動地按照順序進行取指令並加以執行的，加入你在指令集中混雜了非指令的數據將會導致處理器無法正常工作（Hack :question: )，因此實際上指令和數據是分開存放的，分別處於指令區和數據區，並要告訴處理器要執行的指令處於内存的位置。

#### 内存儲器

#### 讀取操作

#### 寄存器（8086通用）

